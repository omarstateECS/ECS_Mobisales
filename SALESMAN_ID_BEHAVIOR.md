# Salesman ID Auto-Increment Behavior

## Overview
Salesman IDs are automatically generated by PostgreSQL starting from **1000000** and incrementing by 1 for each new salesman.

## Important: ID Sequence Gaps

### Why ID Gaps Occur
PostgreSQL's auto-increment sequences **increment even when a transaction fails or is rolled back**. This is intentional database behavior designed to:

1. **Prevent race conditions** - Multiple concurrent insert attempts won't conflict
2. **Maintain performance** - No need to lock the sequence during transaction rollback
3. **Ensure uniqueness** - IDs are never reused, even after failed inserts

### Common Scenarios That Create Gaps

1. **Validation Failures**
   - User submits invalid data (e.g., missing required fields)
   - Validation fails before database insert
   - Sequence has already incremented
   - Next successful insert will have a gap

2. **Duplicate Phone Numbers**
   - User tries to create salesman with existing phone
   - Unique constraint violation occurs
   - Sequence has incremented but record wasn't created

3. **Network/Connection Errors**
   - Insert starts but connection drops
   - Transaction rolls back but sequence remains incremented

### Example
```
Attempt 1: Create salesman (validation fails) → Sequence: 1000001 (not used)
Attempt 2: Create salesman (success) → ID: 1000001 ❌ WRONG! → ID: 1000002 ✓
Attempt 3: Create salesman (success) → ID: 1000003 ✓
```

Result: IDs are 1000002, 1000003 (gap at 1000001)

## This is Normal and Expected

- **ID gaps are NOT a bug** - This is standard PostgreSQL behavior
- **IDs remain unique** - No duplicate IDs will ever be created
- **Gaps don't affect functionality** - The system works correctly with gaps
- **Don't try to "fix" gaps** - Attempting to reuse IDs can cause serious issues

## Frontend Implementation

The frontend **does not predict** the next ID because:
- Predictions would be inaccurate due to sequence behavior
- Multiple users could see the same "predicted" ID
- Failed validations would make predictions incorrect

Instead:
- ID field shows "Will be auto-generated"
- Database assigns actual ID on successful creation
- Frontend receives the real ID in the response

## Technical Details

**Database Configuration:**
```sql
-- Salesman ID sequence starts at 1000000
ALTER SEQUENCE "Salesman_salesId_seq" RESTART WITH 1000000;
```

**Schema Definition:**
```prisma
model Salesman {
  salesId  Int  @id @default(autoincrement())
  // ... other fields
}
```

## Best Practices

1. ✅ **Accept that gaps will occur** - This is normal database behavior
2. ✅ **Use the auto-generated ID** - Don't try to manually set IDs
3. ✅ **Validate data before submission** - Reduces unnecessary sequence increments
4. ❌ **Don't try to reuse skipped IDs** - This can cause data integrity issues
5. ❌ **Don't rely on sequential IDs** - Gaps are expected and normal

## References

- [PostgreSQL Serial Types Documentation](https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-SERIAL)
- [Why Auto-Increment Skips Numbers](https://wiki.postgresql.org/wiki/Don%27t_Do_This#Don.27t_use_serial)
